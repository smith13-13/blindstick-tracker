<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blindman Stick Tracker - Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo svg {
            width: 60px;
            height: 60px;
        }
        
        .btn-login {
            background-color: #3498db;
            border-color: #3498db;
        }
        
        .btn-login:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
    </style>
</head>

<body>
    <div class="login-container">
        <div class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
                <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
                <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.252 2.252l.823.823zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.252 2.252l.823.823z"/>
                <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
            </svg>
            <h2>Blindman Stick Tracker</h2>
            <p class="text-muted">Caregiver Login</p>
        </div>
        <form id="loginForm">
            <div class="mb-3">
                <label for="loginUsername" class="form-label">Username</label>
                <input type="text" class="form-control" id="loginUsername" required>
            </div>
            <div class="mb-3">
                <label for="loginPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="loginPassword" required>
            </div>
            <div class="d-grid mb-2">
                <button type="submit" class="btn btn-login text-white">Login</button>
            </div>
            <div class="text-center">
                <a href="#" id="showRegister">Don't have an account? Register</a>
            </div>
        </form>
        <form id="registerForm" style="display:none;">
            <div class="mb-3">
                <label for="registerUsername" class="form-label">Username</label>
                <input type="text" class="form-control" id="registerUsername" required>
            </div>
            <div class="mb-3">
                <label for="registerPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="registerPassword" required>
            </div>
            <div class="mb-3">
                <label for="registerConfirm" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="registerConfirm" required>
            </div>
            <div class="mb-3">
                <label for="registerStickNumber" class="form-label">Blind Stick Number</label>
                <input type="text" class="form-control" id="registerStickNumber" required>
            </div>
            <div class="d-grid mb-2">
                <button type="submit" class="btn btn-success">Register</button>
            </div>
            <div class="text-center">
                <a href="#" id="showLogin">Already have an account? Login</a>
            </div>
        </form>
        <div id="formMessage" class="text-center text-danger mt-2"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        const formMessage = document.getElementById('formMessage');

        showRegister.onclick = function(e) {
            e.preventDefault();
            loginForm.style.display = 'none';
            registerForm.style.display = '';
            formMessage.textContent = '';
        };
        showLogin.onclick = function(e) {
            e.preventDefault();
            registerForm.style.display = 'none';
            loginForm.style.display = '';
            formMessage.textContent = '';
        };

        loginForm.onsubmit = async function(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            if (!username || !password) {
                formMessage.textContent = 'Please enter username and password.';
                return;
            }
            try {
                const res = await fetch('https://blindstick-tracker-3.onrender.com/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        password
                    })
                });
                const data = await res.json();
                if (!res.ok) {
                    formMessage.textContent = data.error || 'Login failed.';
                    return;
                }
                localStorage.setItem('authToken', data.token);
                window.location.href = 'index.html';
            } catch (err) {
                formMessage.textContent = 'Network error.';
            }
        };

        registerForm.onsubmit = async function(e) {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirm = document.getElementById('registerConfirm').value;
            const blindStickNumber = document.getElementById('registerStickNumber').value.trim();
            if (!username || !password || !confirm || !blindStickNumber) {
                formMessage.textContent = 'Please fill all fields.';
                return;
            }
            if (password !== confirm) {
                formMessage.textContent = 'Passwords do not match.';
                return;
            }
            try {
                const res = await fetch('https://blindstick-tracker-3.onrender.com/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        password,
                        blindStickNumber
                    })
                });
                const data = await res.json();
                if (!res.ok) {
                    formMessage.textContent = data.error || 'Registration failed.';
                    return;
                }
                formMessage.textContent = 'Registration successful! You can now log in.';
                setTimeout(() => {
                    registerForm.style.display = 'none';
                    loginForm.style.display = '';
                    formMessage.textContent = '';
                }, 1500);
            } catch (err) {
                formMessage.textContent = 'Network error.';
            }
        };
    </script>
</body>